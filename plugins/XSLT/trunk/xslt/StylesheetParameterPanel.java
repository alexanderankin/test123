/* *  StylesheetPanel.java - GUI panel for list of XSL parameters * *  Copyright (C) 2003 Robert McKinnon * *  This program is free software; you can redistribute it and/or *  modify it under the terms of the GNU General Public License *  as published by the Free Software Foundation; either version 2 *  of the License, or any later version. * *  This program is distributed in the hope that it will be useful, *  but WITHOUT ANY WARRANTY; without even the implied warranty of *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the *  GNU General Public License for more details. * *  You should have received a copy of the GNU General Public License *  along with this program; if not, write to the Free Software *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA. */package xslt;import org.gjt.sp.jedit.jEdit;import org.gjt.sp.util.Log;import javax.swing.*;import javax.swing.event.ListSelectionEvent;import javax.swing.event.ListSelectionListener;import javax.swing.event.TableModelListener;import javax.swing.event.TableModelEvent;import javax.swing.table.DefaultTableModel;import javax.swing.table.TableModel;import java.awt.*;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.util.LinkedList;import java.util.HashMap;import java.util.Map;/** * GUI panel for list of XSL parameters * * @author Robert McKinnon - robmckinnon@users.sourceforge.net */public class StylesheetParameterPanel extends JPanel implements ActionListener, ListSelectionListener, TableModelListener {  private static final String PARAMETER_ADD = "parameters.add";  private static final String PARAMETER_REMOVE = "parameters.remove";  private static final String[] BLANK_ROW_DATA = new String[]{"", ""};//  private View view;  private DefaultTableModel parameterTableModel;  private JTable parameterTable;  private JButton addParameterButton;  private JButton removeParameterButton;  private static final String PARAMETER_NAME = "XSLTProcessor.parameter.name";  private static final String PARAMETER_VALUE = "XSLTProcessor.parameter.value";  /**   * Constructor for the XSLTProcessor object.   *   */  public StylesheetParameterPanel() {    super(new GridBagLayout());    this.parameterTableModel = initParameterTableModel();    this.parameterTableModel.addTableModelListener(this);    this.parameterTable = initParameterTable(this.parameterTableModel);    this.addParameterButton = XSLTProcessor.initButton(PARAMETER_ADD, this, true);    this.removeParameterButton = XSLTProcessor.initButton(PARAMETER_REMOVE, this, false);    String label = jEdit.getProperty("XSLTProcessor.parameters.label");    JScrollPane tablePane = new JScrollPane(this.parameterTable);    StylesheetPanel.initPanel(this, label, tablePane, this.addParameterButton, this.removeParameterButton);  }  public void actionPerformed(ActionEvent e) {    String action = e.getActionCommand();    if(action == PARAMETER_ADD) {      addParameter();    } else if(action == PARAMETER_REMOVE) {      removeParameter();    }  }  public void valueChanged(ListSelectionEvent e) {    boolean selectionExists = this.parameterTable.getSelectedRow() != -1;    this.removeParameterButton.setEnabled(selectionExists);  }  public void tableChanged(TableModelEvent e) {//    if(e.getType() == TableModelEvent.UPDATE) {    int row = e.getFirstRow();    int column = e.getColumn();    String text = (String) this.parameterTableModel.getValueAt(row, column);    Log.log(Log.DEBUG, this, "row " + row);    Log.log(Log.DEBUG, this, "column " + column);    Log.log(Log.DEBUG, this, "text " + text);    setParameters();//    } else  }  private void setParameters() {    LinkedList nameList = new LinkedList();    LinkedList valueList = new LinkedList();    for(int i = 0; i < this.parameterTableModel.getRowCount(); i++) {      nameList.add(this.parameterTableModel.getValueAt(i, 0));      valueList.add(this.parameterTableModel.getValueAt(i, 1));    }    PropertyUtil.setEnumeratedProperty(PARAMETER_NAME, nameList, jEdit.getProperties());    PropertyUtil.setEnumeratedProperty(PARAMETER_VALUE, valueList, jEdit.getProperties());  }  public Map getStylesheetParameters() {    Object[] names = PropertyUtil.getEnumeratedProperty(PARAMETER_NAME, jEdit.getProperties()).toArray();    Object[] values = PropertyUtil.getEnumeratedProperty(PARAMETER_VALUE, jEdit.getProperties()).toArray();    Map parameterMap = new HashMap();    for(int i = 0; i < names.length; i++) {      parameterMap.put(names[i], values[i]);    }    return parameterMap;  }  private DefaultTableModel initParameterTableModel() {    String[] columnNames = {"Name", "Value"};    Object[] names = PropertyUtil.getEnumeratedProperty(PARAMETER_NAME, jEdit.getProperties()).toArray();    Object[] values = PropertyUtil.getEnumeratedProperty(PARAMETER_VALUE, jEdit.getProperties()).toArray();    DefaultTableModel tableModel = new DefaultTableModel(columnNames, names.length);    tableModel.setColumnCount(2);    for(int i = 0; i < names.length; i++) {      tableModel.setValueAt(names[i], i, 0);      tableModel.setValueAt(values[i], i, 1);    }    return tableModel;  }  private JTable initParameterTable(TableModel model) {    JTable table = new JTable(model);    table.getSelectionModel().addListSelectionListener(this);//      table.getSelectionModel().addListSelectionListener(XPathTool.this);    table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);    return table;  }  private void addParameter() {    this.parameterTableModel.addRow(BLANK_ROW_DATA);    int lastRow = this.parameterTableModel.getRowCount() - 1;    this.parameterTable.getSelectionModel().setSelectionInterval(lastRow, lastRow);    this.parameterTable.requestFocus();  }  private void removeParameter() {    int selectedRow = this.parameterTable.getSelectedRow();    if(selectedRow != -1) {      this.parameterTableModel.removeRow(selectedRow);    }  }}