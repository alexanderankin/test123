<?xml version="1.0"?>
<book xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation='http://www.docbook.org/xsd/4.4/docbook.xsd' >
<!-- :wrap=soft:maxLineLen=0: -->
<title>jEdit CtagsInterface Plugin Guide</title>
<bookinfo>
 <authorgroup>
  <author><firstname>Shlomy</firstname><surname>Reinstein</surname></author>
 </authorgroup>
 
 <legalnotice><title>Legal Notice</title>
  <para>
   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.1 or
   any later version published by the Free Software Foundation; with no
   <quote>Invariant Sections</quote>, <quote>Front-Cover Texts</quote> or
   <quote>Back-Cover Texts</quote>, each as defined in the license. A copy of
   the license can be found in the file <filename>COPYING.DOC.txt</filename>
   included with jEdit.
  </para>

 </legalnotice>
 </bookinfo>
 
 <chapter id="intro"> 
  <title> Introduction </title>

 <para> The CtagsInterfacePlugin provides two dockables, a <guilabel>Tag List</guilabel> and a <guilabel>Tag Preview</guilabel>. It also provides a number of operations that allow you to quickly jump from one file location to another in the editor, based on the context of the caret, and the indexed tag information obtained from the <ulink url="http://ctags.sourceforge.net/">Exuberant Ctags</ulink> executable. And finally, it provides a plugin interface through which other jedit plugins can easily access ctags data.
 </para>
 
 <note> <title> About Memory and Database Size </title>
 <para> Because the database can get rather large, depending on how much sourcecode is indexed, this can also mean that jEdit's JVM will require a larger heap size. Be sure to keep that in mind, if you find that jEdit periodically grinds to a halt, or crashes, when CtagsInterface is used - out of heap memory errors can happen in many different places and may exhibit very different behavior depending on where it happens first. You can increase the JVM heap size by editing the script that starts jEdit
 </para>
 
<programlisting>
export JAVA_HEAP_SIZE=750
[...] 
exec "$JAVA_HOME/bin/java" -mx${JAVA_HEAP_SIZE}m  "-Djedit.home=$JEDIT_HOME" 
 "-Dawt.useSystemAAFontSettings=on" "-Dswing.aatext=true"
 ${JEDIT} -jar "$JEDIT_HOME/jedit.jar" -reuseview $@
</programlisting>
</note>
 </chapter>

 <chapter id="configuration">
 <title> Configuration </title>

 <para> CtagsInterface will happily index all files in your project or source tree, unless you tell it otherwise.
 Under <literal>Plugin Options - CtagsInterface - General</literal> you will find a field for specifying <emphasis role="bold">Ctags Invocation Options</emphasis>. By adding extra options to this field, as shown below, you can specify that only certain file types are scanned and indexed. </para>
 
 <literallayout> --languages=c,c++,java,python </literallayout>
 
 <para> CtagsInterface will work out of the box with two open-source Java databases: <ulink url= "http://hsqldb.org/">hsql</ulink>, and <ulink url="http://www.h2database.com/html/main.html">h2</ulink>. You must make sure that at least one of them is available in the ~/.jedit/jars directory. The in-process java databases are preferred for their ability to be used without any configuration.  However, for larger databases, you may want to consider using mysql.  </para>
 
 <para> To use a mysql database called <literal>ctags</literal> on <literal>localhost</literal>, you can follow these steps. </para>
 
 
 <orderedlist>
   <listitem><para>  As the root user, create a database and grant the user "sa" all priveleges to it: </para>
   <literallayout>
   create database ctags;
   grant all on ctags.* to 'sa'@'localhost';
   </literallayout>   
   </listitem>
   
   <listitem> <para> <emphasis role="bold">Plugins - CtagsInterface - Change Database Settings</emphasis> (You might want to map this to a shortcut now..) </para></listitem> 
   <listitem><para>
    <literal>Select Preset Values</literal>: <emphasis>Custom</emphasis> </para>

    <table>
    <title>Mysql settings:</title>
    <tgroup cols="2">
        <thead> <row><entry>Entry</entry><entry>Value</entry></row> </thead>
    <tbody>
        <row> <entry> JDBC Driver Class</entry> <entry> com.mysql.jdbc.Driver </entry> </row>
        <row> <entry> Connection String </entry> <entry> jdbc:mysql://localhost:3306/ctags </entry> </row>
        <row> <entry> User </entry> <entry> sa </entry> </row>        
        <row> <entry> Password </entry> <entry>  </entry> </row>
        <row> <entry> SQL Mappings file: </entry> <entry> jeditresource:/CtagsInterface.jar!/mysql.map  </entry> </row>
    </tbody>
    </tgroup> </table> 
    </listitem>
    <listitem><para> <literal>Save as:</literal> <emphasis role="bold">mysql</emphasis> </para></listitem>
    
</orderedlist>
    <para> The mappings file, <literal>mysql.map</literal> contains necessary type mappings for mysql, but mappings can be defined for other databases as well. The current mapping for mysql contains two lines: </para>
<literallayout>
    identityType=SERIAL
    varcharType=VARCHAR(300)
</literallayout>
   <para> This means that when using this database setup, instead of using IDENTITY, it uses SERIAL, and instead of VARCHAR, we must specify a fixed-size string, since VARCHAR without a size is not supported in mysql. </para>
   
  <para> The option <emphasis role="bold">Rebuild new database using current projects and source trees</emphasis> can also be used to bring over and reindex the set of projects from one existing ctags database to another. </para>


</chapter>
 
 

 <chapter id="tagdbs">
   <title> Tagging Projects and Source Trees </title>
   
   <para> CtagsInterface uses the sql database to keep track of tag data from multiple projects and directory trees.    The <guimenuitem>Plugin Options - CtagsInterface</guimenuitem> provides dialogs for adding projects and directory trees that should be indexed.
   </para>
  
   <para> The first step is to add the projects and source trees that you want to be tagged in the database. Tag them in the background, and go back into jEdit. 
   When they are done, you should see no pending I/O requests in the <guimenuitem>Utilities - Troubleshooting - I/O Progress Monitor</guimenuitem>. After your selected projects have been added, you can lookup some tags. </para>
   
   <para> You can add projects two ways. From the ProjectViewer, right click on the project and <guimenuitem>Add Project to Database</guimenuitem>. Or, from <guimenuitem>Plugin Options - CtagsInterface - Projects</guimenuitem>. </para>
   
   <para> Similarly, you can add sourcetrees from the <guimenuitem>plugin options - CtagsInterface - Source Trees</guimenuitem>, or from the file system browser context menu: <guimenuitem>Plugins - Add source tree to Tags Database</guimenuitem>. </para> 
   
 </chapter>

 <chapter id="lookup">
   <title> Tag Lookup </title>
   
   <para> By default, tag lookup will search the entire tag database for matching tags, including all added projects and source trees. </para>
   
   <para> When using jEdit with ProjectViewer, you might be working with a set of files, and have to frequently check another set of files that you are reusing. This means that you will probably want to restrict your search to only the projects and source trees that are related to your project. </para> 
   
   
   <para> By editing the properties of the current project, you can see a <guilabel>Dependencies</guilabel> pane, which allows you to set the related projects or source trees on an individual project basis. While running the Tag Preview, or performing a Jump to Tag while working in a project that has dependencies set, CtagsInterface should restrict its searches to tag data from only those projects and directory trees.
   </para>

   <para> This is especially useful in the case where there are many projects / source trees indexed in the tags database that are not related to each other. 
   </para>
   
 </chapter>
 
 <chapter id="actions">
   <title> Actions </title>
   
   <formalpara><title> Add tag File </title>
   <para> Adds an already generated ctags file to the database. </para>
   </formalpara>
   
   <formalpara><title> Tag all projects </title>
   <para> This does exactly what it says: it goes through <emphasis role="bold">every</emphasis> project that ProjectViewer knows about, and tags their files, adding the tag data to the embedded database. 
   </para>
   </formalpara>
   
   <section id="dynamic-actions">
   <title> Dynamic Actions </title>
   
   
   <para> In addition to these built-in actions, CtagsInterface allows you to create dynamic Actions, which are custom SQL queries, which can be bound to keyboard shortcuts. Each such SQL query should retrieve a list of tags from the database. The dynamic action associated with the query will execute the query and show the list of tags it retrieved in the <guilabel>Tag List</guilabel> dockable, allowing you to jump to any of them. In case the query returns a single tag, the dynamic action jumps to it directly, without showing it in the dockable.
   </para>
   <para> To manage (create/delete/modify) dynamic actions, select the <guilabel>Actions</guilabel> pane in the plugin options.
   To define a new dynamic action, click the <guilabel>+</guilabel> button. You will be asked to provide a name for the action and an SQL query. The action name you provide should not contain spaces, as it is used to define an ordinary edit action. The SQL query is an ordinary SQL <guilabel>select</guilabel> statement, which can make use of the following keywords:
   <itemizedlist>
      <listitem><para><guilabel>{tag}</guilabel>: The tag being looked up</para></listitem>
      <listitem><para><guilabel>{project}</guilabel>: The name of the active project</para></listitem>
   </itemizedlist>
   Here are a few examples:
   <itemizedlist>
      <listitem><para>select * from tags,files,map,origins where tags.file_id=files.id and tags.name='{tag}' and a_kind='function' and files.id=map.file_id and map.origin_id=origins.id and origins.name='{project}'
	  </para></listitem>
      <listitem><para>select * from tags,files,map,origins where tags.file_id=files.id and tags.name='{tag}' and a_kind='prototype'  and files.id=map.file_id and map.origin_id=origins.id and origins.name='{project}'
	  </para></listitem>
   </itemizedlist>
   </para>
   
   </section>
   
 </chapter>
 
 <chapter id="dockables">
   <title> CtagsInterface Dockables </title>
   
   <para> There are two dockables that you can use from CtagsInterface. </para>
   
   <formalpara> <title> Tag List </title>
   <para> When <action>jump to tag</action> is invoked, if there is more than one possible match, the Tag List dockable is displayed, where you can preview and select the choices of jump locations. </para>
   
   </formalpara>
   <formalpara> <title> Tag Preview </title>
   <para> This dockable is updated automatically (after a configurable delay) whenever the caret is moved over a location that is a known symbol in the tag database. 
   </para>
   
   </formalpara>
   
 </chapter>
   
 <chapter id="pluginservices">
   <title> Services to other plugins </title>
   <para> CtagsInterface also offers services to other plugins: ClassBrowser, and Tags: </para>
   
   <orderedlist>
   <listitem><para> Queries of the tags database </para></listitem>
   <listitem><para> Jumping to tags. </para></listitem>
   </orderedlist>

   <para> Since the CtagsInterface manages the tags information and runs ctags, this means that other plugins do not need to call/depend on ctags directly. This also means that in the future, the CtagsInterface may be extended to work with other code-indexing tools. </para>
   
  </chapter>
 
<appendix id="changelog">
 <title> Changelog </title>
 
<itemizedlist>
 <listitem><para> <emphasis role="bold">Version 0.1</emphasis> - Requires jedit 4.3pre12, Java 1.5, and ProjectViewer 2.1.3 (optional). </para>
  <para> Initial release </para>
 </listitem>
</itemizedlist>

</appendix>

 
</book> 
